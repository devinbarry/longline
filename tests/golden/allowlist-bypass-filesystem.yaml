tests:
  # ============================================================
  # BARE COMMAND BYPASSES - Dangerous flags on allowlisted commands
  # ============================================================

  # --- ln: symbolic link attacks ---
  - id: ln-symlink
    command: "ln -s source.txt link.txt"
    expected:
      decision: ask
    # ln creates/modifies filesystem
  - id: ln-force-overwrite
    command: "ln -sf malicious.sh /usr/local/bin/safe"
    expected:
      decision: ask
    # ln -sf can overwrite files/binaries

  # --- tar: extraction attacks ---
  - id: tar-list-safe
    command: "tar -tf archive.tar"
    expected:
      decision: allow
    # -t just lists contents, read-only
  - id: tar-extract
    command: "tar -xf archive.tar"
    expected:
      decision: ask
    # tar -xf can overwrite files, path traversal
  - id: tar-extract-overwrite
    command: "tar -xvf archive.tar --overwrite"
    expected:
      decision: ask
    # explicit overwrite flag

  # --- unzip: extraction attacks ---
  - id: unzip-list-safe
    command: "unzip -l archive.zip"
    expected:
      decision: allow
    # -l just lists contents, read-only
  - id: unzip-extract
    command: "unzip archive.zip"
    expected:
      decision: ask
    # unzip can overwrite files
  - id: unzip-overwrite-force
    command: "unzip -o archive.zip"
    expected:
      decision: ask
    # -o forces overwrite without prompting

  # --- sed: in-place modification ---
  - id: sed-stdout-safe
    command: "sed 's/foo/bar/' file.txt"
    expected:
      decision: allow
    # outputs to stdout, read-only
  - id: sed-inplace
    command: "sed -i 's/foo/bar/' file.txt"
    expected:
      decision: ask
    # -i modifies files in place
  - id: sed-inplace-backup
    command: "sed -i.bak 's/foo/bar/' file.txt"
    expected:
      decision: ask
    # still modifies original

  # --- patch: file modification ---
  - id: patch-dryrun-safe
    command: "patch --dry-run < changes.patch"
    expected:
      decision: allow
    # --dry-run doesn't modify anything
  - id: patch-apply
    command: "patch < changes.patch"
    expected:
      decision: ask
    # patch modifies files
  - id: patch-apply-strip
    command: "patch -p1 < changes.patch"
    expected:
      decision: ask
    # patch modifies files

  # --- gzip/gunzip: removes original ---
  - id: gzip-keep-safe
    command: "gzip -k file.txt"
    expected:
      decision: allow
    # -k keeps original
  - id: gzip-remove-original
    command: "gzip file.txt"
    expected:
      decision: ask
    # gzip removes original by default
  - id: gunzip-keep-safe
    command: "gunzip -k file.txt.gz"
    expected:
      decision: allow
    # -k keeps original
  - id: gunzip-remove-original
    command: "gunzip file.txt.gz"
    expected:
      decision: ask
    # gunzip removes original by default

  # --- npx: arbitrary code execution ---
  - id: npx-known-package
    command: "npx prettier --check ."
    expected:
      decision: ask
      rule_id: npx-run
    # npx downloads and executes arbitrary code
  - id: npx-arbitrary-package
    command: "npx some-random-package"
    expected:
      decision: ask
    # npx can run arbitrary npm packages
  - id: npx-typosquat-risk
    command: "npx loadash"
    expected:
      decision: ask
    # typosquatting risk (lodash vs loadash)

  # --- find: file deletion ---
  - id: find-name-safe
    command: "find . -name '*.rs'"
    expected:
      decision: allow
    # just lists files, read-only
  - id: find-type-safe
    command: "find . -type f"
    expected:
      decision: allow
    # just lists files, read-only
  - id: find-delete
    command: "find . -delete"
    expected:
      decision: ask
      rule_id: find-delete
    # deletes files
  - id: find-exec-rm
    command: "find . -exec rm {} \\;"
    expected:
      decision: ask
      rule_id: find-exec-rm
    # deletes files via exec

  # --- xargs: command execution ---
  - id: xargs-echo-safe
    command: "xargs echo"
    expected:
      decision: allow
    # echo is read-only
  - id: xargs-cat-safe
    command: "xargs cat"
    expected:
      decision: allow
    # cat is read-only
  - id: xargs-rm
    command: "xargs rm"
    expected:
      decision: ask
      rule_id: xargs-rm
    # deletes files
  - id: xargs-rm-rf
    command: "xargs rm -rf"
    expected:
      decision: ask
      rule_id: xargs-rm
    # deletes files recursively

  # --- cp: can overwrite destination ---
  - id: cp-basic
    command: "cp a.txt b.txt"
    expected:
      decision: ask
    # cp can silently overwrite b.txt
  - id: cp-recursive
    command: "cp -r src/ dest/"
    expected:
      decision: ask
    # cp -r can overwrite dest/
  - id: cp-force
    command: "cp -f sensitive.txt /tmp/exfil"
    expected:
      decision: ask
    # -f forces overwrite without prompting
  - id: cp-force-recursive
    command: "cp -rf /important /tmp/backup"
    expected:
      decision: ask
    # -rf can overwrite directories

  # --- mv: removes source, can overwrite destination ---
  - id: mv-basic
    command: "mv a.txt b.txt"
    expected:
      decision: ask
    # mv removes a.txt and can overwrite b.txt
  - id: mv-force
    command: "mv -f important.txt /dev/null"
    expected:
      decision: ask
    # -f forces overwrite without prompting

  # --- tee: writes/overwrites files ---
  - id: tee-basic
    command: "tee output.txt"
    expected:
      decision: ask
    # tee can overwrite output.txt
  - id: tee-etc-passwd
    command: "tee /etc/passwd"
    expected:
      decision: ask
    # writing to system file
  - id: tee-etc-shadow
    command: "tee /etc/shadow"
    expected:
      decision: ask
    # writing to system file
  - id: tee-append-bashrc
    command: "tee -a ~/.bashrc"
    expected:
      decision: deny
      rule_id: edit-shell-profile
    # modifying shell profile
