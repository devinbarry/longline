# CLI tools: gh, glab, glp, git-cliff

allowlists:
  commands:
    # ── glp (GitLab Pipeline CLI): read-only invocations ──────────
    - { command: "glp status", trust: minimal }
    - { command: "glp jobs", trust: minimal }
    - { command: "glp log", trust: minimal }
    - { command: "glp --version", trust: minimal }
    - { command: "glp --help", trust: minimal }
    - { command: "glp -h", trust: minimal }
    # ── glab (GitLab CLI): read-only invocations ──────────────────
    # Note: mutating API calls (POST/PUT/DELETE/PATCH) caught by glab-api-mutating rule
    - { command: "glab auth status", trust: minimal }
    - { command: "glab ci status", trust: minimal }
    - { command: "glab ci view", trust: minimal }
    - { command: "glab ci list", trust: minimal }
    - { command: "glab ci trace", trust: minimal }
    - { command: "glab ci get", trust: minimal }
    - { command: "glab repo list", trust: minimal }
    - { command: "glab repo view", trust: minimal }
    - { command: "glab group list", trust: minimal }
    - { command: "glab issue list", trust: minimal }
    - { command: "glab issue view", trust: minimal }
    - { command: "glab mr list", trust: minimal }
    - { command: "glab mr view", trust: minimal }
    - { command: "glab --version", trust: minimal }
    - { command: "glab --help", trust: minimal }
    # ── gh (GitHub CLI): read-only invocations ───────────────────────
    # Note: mutating API calls (POST/PUT/DELETE/PATCH) caught by gh-api-mutating rule
    - { command: "gh pr list", trust: minimal }
    - { command: "gh pr view", trust: minimal }
    - { command: "gh pr status", trust: minimal }
    - { command: "gh pr diff", trust: minimal }
    - { command: "gh pr checks", trust: minimal }
    - { command: "gh issue list", trust: minimal }
    - { command: "gh issue view", trust: minimal }
    - { command: "gh issue status", trust: minimal }
    - { command: "gh repo list", trust: minimal }
    - { command: "gh repo view", trust: minimal }
    - { command: "gh auth status", trust: minimal }
    - { command: "gh --version", trust: minimal }
    - { command: "gh --help", trust: minimal }
    - { command: "gh -h", trust: minimal }
    # ── glab/gh: standard invocations (side-effect potential) ─────
    - { command: "glab api", trust: standard }
    - { command: "gh api", trust: standard }
    - { command: "gh run list", trust: standard }
    - { command: "gh run view", trust: standard }
    - { command: "gh run watch", trust: standard }
    - { command: "gh workflow list", trust: standard }
    - { command: "gh workflow view", trust: standard }
    # ── git-cliff: stdout-only invocations ────────────────────────
    - { command: "git-cliff", trust: standard }
    - { command: "git-cliff --unreleased", trust: standard }
    - { command: "git-cliff --latest", trust: standard }
    - { command: "git-cliff --current", trust: standard }

rules:
  # ============================================================
  # HIGH: CLI tool mutating operations
  # ============================================================
  - id: glab-api-mutating
    level: high
    match:
      command: glab
      args:
        any_of: ["POST", "PUT", "DELETE", "PATCH"]
    decision: ask
    reason: "GitLab API mutating operation (POST/PUT/DELETE/PATCH)"

  - id: gh-api-mutating
    level: high
    match:
      command: gh
      args:
        any_of: ["POST", "PUT", "DELETE", "PATCH"]
    decision: ask
    reason: "GitHub API mutating operation (POST/PUT/DELETE/PATCH)"

  - id: git-cliff-write-file
    level: high
    match:
      command: git-cliff
      flags:
        any_of: ["-o", "--output", "--init", "--tag"]
    decision: ask
    reason: "git-cliff operation that writes files or modifies state"
