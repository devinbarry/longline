# Git operations: read/write commands and destructive operations

allowlists:
  commands:
    # ── Git: read operations ──────────────────────────────────────
    - "git status"
    - "git diff"
    - "git log"
    - "git show"
    - "git branch"
    - "git stash list"
    - "git remote"
    - "git tag"
    - "git rev-parse"
    - "git config"
    # ── Git: safe write operations ────────────────────────────────
    - "git add"
    - "git commit"
    - "git fetch"
    - "git pull"
    - "git push"
    - "git stash"
    - "git checkout"
    - "git switch"
    - "git restore"
    - "git merge"
    - "git cherry-pick"
    - "git worktree"
    - "git clone"
    - "git init"
    # ── Git: read-only extras ─────────────────────────────────────
    - "git blame"
    - "git bisect"
    - "git describe"
    - "git shortlog"
    - "git reflog"
    - "git ls-files"
    - "git ls-tree"
    - "git cat-file"
    - "git grep"
    - "git archive"
    # ── Git: safe file operations ────────────────────────────────────
    - "git mv"
    - "git rm"
    - "git revert"
    # ── Git: stash operations ────────────────────────────────────────
    - "git stash pop"
    - "git stash apply"
    # ── Git: info/help commands ───────────────────────────────────
    - "git --version"
    - "git -v"
    - "git help"
    - "git -h"
    # ── Git: maintenance/inspection commands ──────────────────────
    - "git gc"
    - "git fsck"
    - "git verify-pack"
    # ── Git: history/ref commands ─────────────────────────────────
    - "git merge-base"
    - "git rev-list"
    - "git for-each-ref"
    - "git name-rev"
    # ── Git: bare command (allows git -C, etc; rules catch dangerous ops) ──
    - git

rules:
  # ============================================================
  # HIGH: VCS destructive operations
  # ============================================================
  - id: git-force-push-main
    level: high
    match:
      command: git
      flags:
        any_of: ["--force", "-f"]
      args:
        any_of: ["main", "master"]
    decision: deny
    reason: "Force pushing to main/master branch"

  - id: git-reset-hard
    level: high
    match:
      command: git
      args:
        any_of: ["--hard"]
    decision: ask
    reason: "git reset --hard discards uncommitted changes"

  - id: git-clean-force
    level: high
    match:
      command: git
      args:
        any_of: ["clean"]
      flags:
        any_of: ["-f", "--force", "-fd", "-fx", "-fxd"]
    decision: ask
    reason: "git clean -f permanently removes untracked files"

  - id: git-branch-delete-force
    level: high
    match:
      command: git
      args:
        any_of: ["branch"]
      flags:
        any_of: ["-D"]
    decision: ask
    reason: "Force deleting a git branch"

  - id: git-commit-amend
    level: high
    match:
      command: git
      args:
        any_of: ["commit"]
      flags:
        any_of: ["--amend"]
    decision: ask
    reason: "git commit --amend rewrites the previous commit"

  - id: git-remote-modify
    level: high
    match:
      command: git
      args:
        any_of: ["remote"]
      flags:
        any_of: ["add", "remove", "rm", "set-url", "rename"]
    decision: ask
    reason: "Modifying git remote configuration"

  - id: git-tag-delete
    level: high
    match:
      command: git
      args:
        any_of: ["tag"]
      flags:
        any_of: ["-d", "--delete"]
    decision: ask
    reason: "Deleting git tag"

  - id: git-push-delete
    level: high
    match:
      command: git
      args:
        any_of: ["push"]
      flags:
        any_of: ["--delete", "-d"]
    decision: ask
    reason: "Deleting remote branch or tag"

  - id: git-config-global
    level: high
    match:
      command: git
      args:
        any_of: ["config"]
      flags:
        any_of: ["--global", "--system"]
    decision: ask
    reason: "Modifying global/system git configuration"

  - id: git-stash-drop
    level: high
    match:
      command: git
      args:
        any_of: ["stash"]
      flags:
        any_of: ["drop", "clear"]
    decision: ask
    reason: "Dropping stashed changes (data loss)"

  - id: git-reflog-delete
    level: high
    match:
      command: git
      args:
        any_of: ["reflog"]
      flags:
        any_of: ["delete", "expire"]
    decision: ask
    reason: "Deleting reflog entries (history loss)"

  - id: git-gc-prune
    level: high
    match:
      command: git
      args:
        any_of: ["gc"]
      flags:
        starts_with: ["--prune"]
    decision: ask
    reason: "git gc with pruning can remove unreachable objects"

  - id: git-worktree-remove
    level: high
    match:
      command: git
      args:
        any_of: ["worktree"]
      flags:
        any_of: ["remove", "prune"]
    decision: ask
    reason: "Removing git worktree"

  - id: git-bisect-reset
    level: high
    match:
      command: git
      args:
        any_of: ["bisect"]
      flags:
        any_of: ["reset"]
    decision: ask
    reason: "Exiting bisect mode (changes HEAD)"

  - id: git-pull-force
    level: high
    match:
      command: git
      args:
        any_of: ["pull"]
      flags:
        any_of: ["--force", "-f"]
    decision: ask
    reason: "git pull --force can overwrite local changes"

  - id: git-rebase
    level: high
    match:
      command: git
      args:
        any_of: ["rebase"]
    decision: ask
    reason: "git rebase rewrites history and can cause data loss"

  - id: git-symbolic-ref-delete
    level: high
    match:
      command: git
      args:
        any_of: ["symbolic-ref"]
      flags:
        any_of: ["--delete", "-d"]
    decision: ask
    reason: "git symbolic-ref --delete removes symbolic references"

  # ============================================================
  # STRICT: Cautionary git operations
  # ============================================================
  - id: git-force-push-any
    level: strict
    match:
      command: git
      flags:
        any_of: ["--force", "-f"]
      args:
        any_of: ["push"]
    decision: ask
    reason: "Force pushing (any branch)"

  - id: git-checkout-dot
    level: strict
    match:
      command: git
      args:
        any_of: ["checkout", "restore"]
      flags:
        any_of: [".", "--"]
    decision: ask
    reason: "Discarding all local changes"
